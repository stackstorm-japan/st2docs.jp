

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-site-verification" content="ovwnX0ej2kps4UuJ9NOzNjJcLOQD8JPDLNhe-hMYTMk" />
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NKZBMHZ');</script>
  <!-- End Google Tag Manager -->
  
  <title>High Availability Deployment &mdash; StackStorm 2.8dev documentation</title>
  

  <link rel="shortcut icon" href="../_static/favicon.ico?v4"/>
  
  
    <link rel="canonical" href="https://docs.stackstorm.com/reference/ha.html"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,700italic|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="StackStorm 2.8dev documentation" href="../index.html"/>
        <link rel="up" title="References and Guides" href="index.html"/>
        <link rel="next" title="REST API Reference" href="api.html"/>
        <link rel="prev" title="Client Libraries and Language Bindings" href="client_libraries.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NKZBMHZ"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html">
            <svg class="logo"
                xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                viewBox="0 0 680 120"
                xml:space="preserve">
              <polygon points="116,0 56.8,0 116,48.6"/>
              <polygon points="0.7,120 64.7,120 0.7,69.9"/>
              <path d="M450.756 55.793l-8.824-2.206c-4.584-1.161-7.865-2.744-9.85-4.746c-1.982-1.999-2.977-4.727-2.977-8.181 c0-4.549 1.523-8.071 4.568-10.569c3.045-2.496 7.336-3.744 12.875-3.744c5.881 0 10.4 1.5 13.7 4.4 c3.248 2.9 4.9 7.1 5 12.44h7.031c-0.104-7.25-2.385-12.892-6.85-16.929c-4.465-4.034-10.664-6.053-18.596-6.053 c-7.49 0-13.475 1.846-17.955 5.54c-4.48 3.693-6.721 8.603-6.721 14.723c0 5.5 1.5 9.8 4.4 12.9 c2.957 3.1 8.3 5.6 16 7.567l7.184 1.796c7.047 1.8 11.8 3.8 14.1 6.104c2.361 2.3 3.5 5.5 3.5 9.8 c0 4.652-1.686 8.303-5.053 10.954c-3.369 2.649-7.996 3.975-13.879 3.975c-6.701 0-11.9-1.641-15.594-4.924 s-5.574-7.9-5.643-13.851h-6.926v0.512c0 7.9 2.4 13.9 7.3 18.136c4.855 4.2 11.8 6.3 20.8 6.3 c8.035 0 14.371-1.948 19.006-5.848c4.635-3.897 6.951-9.233 6.951-16.004c0-5.883-1.76-10.499-5.283-13.853 C465.598 60.8 459.5 58 450.8 55.8"/>
              <path d="M494.566 27.527h-6.311v15.648h-7.438v5.13h7.438v39.755c0 4.2 0.7 7.1 1.9 8.6 s3.523 2.4 6.7 2.386c1.129 0 2.328-0.096 3.592-0.281c1.268-0.189 2.666-0.489 4.207-0.899l-0.051-5.027 c-1.744 0.377-3.027 0.625-3.85 0.745c-0.82 0.119-1.555 0.179-2.203 0.179c-1.508 0-2.549-0.375-3.131-1.13 c-0.582-0.751-0.871-2.29-0.871-4.616V48.305h10.105v-5.13h-10.105V27.527z"/>
              <path d="M536.99 41.79c-7.934 0-14.082 2.505-18.443 7.514c-4.359 5.01-6.541 12.081-6.541 21.2 c0 9.1 2.2 16.1 6.5 21.11c4.361 5 10.5 7.5 18.4 7.465c8.002 0 14.189-2.496 18.57-7.491 c4.377-4.992 6.566-12.02 6.566-21.084c0-9.132-2.199-16.203-6.592-21.213C551.141 44.3 545 41.8 537 41.8 M550.686 87.6 c-3.215 4.001-7.779 6.001-13.695 6.001c-5.848 0-10.389-2.016-13.619-6.052c-3.234-4.035-4.85-9.713-4.85-17.032 c0-7.352 1.615-13.047 4.85-17.083c3.23-4.035 7.771-6.053 13.619-6.053c5.916 0 10.5 2 13.7 6 c3.217 4 4.8 9.7 4.8 17.109S553.902 83.6 550.7 87.6"/>
              <path d="M586.008 44.508c-2.789 1.812-4.969 4.549-6.541 8.207v-9.541h-6.105v54.531h6.514V67.644 c0-6.395 1.359-11.2 4.078-14.414c2.719-3.215 6.797-4.823 12.234-4.823h0.822V41.79h-0.717 C592.221 41.8 588.8 42.7 586 44.5"/>
              <path d="M675.166 46.227c-2.926-2.957-7.346-4.437-13.262-4.437c-3.898 0-7.346 0.915-10.338 2.7 s-5.395 4.489-7.207 7.977c-0.891-3.42-2.68-6.062-5.377-7.925c-2.699-1.864-6.08-2.796-10.143-2.796 c-3.791 0-7.162 0.897-10.113 2.693c-2.957 1.795-5.355 4.369-7.199 7.72v-9.029h-5.9v54.532h6.311V64.001 c0-4.925 1.477-8.907 4.428-11.954c2.955-3.042 6.82-4.566 11.6-4.566c3.893 0 6.8 1.1 8.7 3.3 c1.879 2.2 2.8 5.5 2.8 10.054v36.886h6.309V63.54c0-4.821 1.453-8.723 4.361-11.696c2.906-2.976 6.771-4.463 11.592-4.463 c4.07 0 7 1 8.8 2.976c1.775 2 2.7 5.3 2.7 9.85v37.5h6.412V59.692 C679.551 53.7 678.1 49.2 675.2 46.2"/>
              <path d="M118.944 67.886c-2.638-4.731-7.001-9.521-13.085-14.393L41.482 0.8 c-4.365 0.046-7.895 0.271-10.581 0.677c-2.734 0.466-5.502 1.227-8.287 2.282c-7.151 2.9-12.714 7.208-16.671 12.9 C1.991 22.4 0 29 0 36.76c0 2.8 0.4 5.8 1.2 8.973c0.762 3.2 1.8 6.1 3.2 8.8 c1.728 3.2 4.6 7 8.7 11.351c4.111 4.5 9.7 9.6 16.7 15.438c7.149 6.1 14.6 11.9 22.2 17.6 c4.731 3.4 8.8 6.4 12.3 8.825c3.447 2.4 9.3 6.5 17.5 12.247c3.098-0.096 5.736-0.263 7.912-0.451 c1.932-0.193 3.863-0.546 5.789-1.013c1.36-0.283 3.006-0.828 4.933-1.642c7.011-2.849 12.514-7.222 16.523-13.117 c4.048-5.868 6.093-12.454 6.093-19.776C122.984 78.1 121.6 72.7 118.9 67.9"/>
              <path d="M182.358 53.177c-7.319-1.88-12.124-3.735-14.416-5.566c-2.292-1.829-3.435-4.181-3.435-7.054 c0-2.838 1.297-5.215 3.896-7.13c2.599-1.915 5.952-2.873 10.056-2.873c4.958 0 8.9 1.2 11.9 3.6 c2.958 2.4 4.6 5.8 4.8 10.056l11.953-0.051c-0.07-7.352-2.559-13.192-7.466-17.519c-4.908-4.327-11.483-6.49-19.725-6.49 c-8.482 0-15.279 1.976-20.391 5.926c-5.112 3.95-7.669 9.073-7.669 15.363c0 5.9 1.7 10.6 5.2 14 c3.489 3.4 9.5 6.3 17.9 8.49c0.754 0.2 1.9 0.4 3.3 0.822c6.839 1.7 11.2 3.4 13.2 5.2 c1.197 1.1 2.2 2.4 2.9 3.924c0.77 1.5 1.2 2.9 1.2 4.079c0 3.044-1.375 5.609-4.128 7.7 c-2.754 2.087-6.285 3.131-10.595 3.131c-5.711 0-10.234-1.351-13.567-4.053c-3.336-2.702-5.174-6.498-5.514-11.389h-12.212 c0.378 8.5 3.2 15 8.4 19.494c5.214 4.5 12.5 6.8 21.9 6.771c8.893 0 15.997-2.163 21.315-6.49 c5.319-4.324 7.977-10.045 7.977-17.16c0-5.882-1.7-10.465-5.104-13.746C200.73 59 193.5 56 182.4 53.2"/>
              <path d="M233.915 27.117h-11.646v15.236h-7.9v8.721h7.9v34.012c0 5 0.9 8.5 2.8 10.4 c1.899 1.9 5.2 2.9 9.8 2.924c1.366 0 3.726-0.171 7.078-0.513c0.511-0.035 0.905-0.068 1.18-0.103v-9.335l-2.308 0.1 c-0.239 0-0.609 0.018-1.105 0.051c-0.494 0.035-0.895 0.053-1.206 0.053c-1.777 0-2.99-0.333-3.639-1 c-0.651-0.668-0.976-2.01-0.976-4.027V51.074h9.234v-8.721h-9.234V27.117z"/>
              <path d="M299.373 89.498c-1.267 0-2.147-0.325-2.643-0.977c-0.497-0.648-0.745-2.032-0.745-4.153V56.922 c0-5.404-1.871-9.481-5.617-12.234c-3.744-2.754-9.293-4.13-16.647-4.13c-7.011 0-12.541 1.599-16.594 4.8 c-4.053 3.2-6.081 7.551-6.081 13.058v0.923h11.134v-0.41c0-2.805 0.957-4.959 2.872-6.465c1.916-1.505 4.667-2.257 8.259-2.257 c3.865 0 6.7 0.6 8.6 1.897c1.845 1.3 2.8 3.2 2.8 5.9c0 3.283-3.711 5.404-11.133 6.4 c-0.513 0.069-0.908 0.12-1.18 0.153c-8.893 1.129-15.03 3.104-18.416 5.924c-3.386 2.822-5.079 7.038-5.079 12.6 c0 5.1 1.6 9.1 4.7 12.056c3.164 2.9 7.5 4.4 13.1 4.36c3.626 0 7.027-0.794 10.208-2.386 c3.18-1.591 5.899-3.838 8.158-6.746c0.068 2.8 1 4.9 2.7 6.311c1.726 1.4 4.4 2.1 7.9 2.1 c0.925 0 1.89-0.069 2.899-0.205c1.009-0.139 2.044-0.345 3.104-0.616v-8.567c-0.718 0.068-1.224 0.112-1.514 0.1 C299.876 89.5 299.6 89.5 299.4 89.5 M284.547 76.878c0 3.831-1.436 6.976-4.31 9.4 c-2.873 2.464-6.481 3.694-10.825 3.694c-2.873 0-5.095-0.692-6.668-2.079c-1.574-1.384-2.36-3.341-2.36-5.874 c0-2.256 0.667-4.077 2.001-5.463c1.333-1.384 3.368-2.333 6.105-2.847c0.922-0.171 2.36-0.41 4.31-0.717 c5.369-0.787 9.284-1.814 11.747-3.079V76.878z"/>
              <path d="M341.311 86.086c-2.174 2-5.021 3.002-8.542 3.002c-4.411 0-7.78-1.634-10.105-4.9s-3.489-8.01-3.489-14.236 c0-6.359 1.174-11.173 3.515-14.439c2.342-3.267 5.805-4.901 10.389-4.901c3.419 0 6.2 1 8.3 2.8 c2.119 1.9 3.3 4.5 3.6 7.774h11.541c-0.34-6.43-2.643-11.483-6.9-15.161c-4.256-3.676-9.891-5.514-16.902-5.514 c-8.036 0-14.337 2.625-18.902 7.874c-4.566 5.25-6.849 12.492-6.849 21.726c0 9 2.2 16.2 6.6 21.4 c4.411 5.3 10.4 7.9 18 7.899c7.355 0 13.246-1.957 17.675-5.872c4.428-3.917 6.916-9.312 7.463-16.186h-11.389 C344.822 81.2 343.5 84.1 341.3 86.1"/>
              <polygon points="414,42.4 399.7,42.4 377.9,64.9 377.9,22.1 366.4,22.1 366.4,97.7 377.9,97.7 377.9,79.2 385.8,71.2 400.7,97.7 414.4,97.7 394,62.7"/>
            </svg>
          </a>
        
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <p class="caption"><span class="caption-text">はじめに</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">StackStorm 概要</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#about">About</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#how-it-works">How it Works</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#what-s-next">What’s Next?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">インストールと設定</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install/overview.html">デプロイ後の構成</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/system_requirements.html">System Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/vagrant.html">Vagrant / OVA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/deb.html">Ubuntu 14.04 / 16.04</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/rhel7.html">RHEL 7 / CentOS 7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/rhel6.html">RHEL 6 / CentOS 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/docker.html">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/ansible.html">Ansible Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/bwc.html">Extreme Workflow Composer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/config/index.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/upgrades.html">Upgrades</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/uninstall.html">Uninstall</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../start.html">クイックスタート</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../start.html#explore-st2-with-cli">Explore StackStorm with CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start.html#authenticate">Authenticate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start.html#work-with-actions">Work with Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start.html#define-a-rule">Define a Rule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start.html#deploy-a-rule">Deploy a Rule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start.html#deploy-examples">Deploy Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start.html#datastore">Datastore</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">基本機能</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../actions.html">Actions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../actions.html#managing-and-running-actions">Managing and Running Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../actions.html#action-runners">Action Runners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../actions.html#writing-custom-actions">Writing Custom Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../actions.html#built-in-parameters">Built-in Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../actions.html#overriding-runner-parameters">Overriding Runner Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../actions.html#environment-variables-available-to-actions">Environment Variables Available to Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../actions.html#converting-existing-scripts-into-actions">Converting Existing Scripts into Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../actions.html#writing-custom-python-actions">Writing Custom Python Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../actions.html#pre-defined-actions">Pre-defined Actions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sensors.html">Sensors and Triggers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../sensors.html#sensors">Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sensors.html#triggers">Triggers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sensors.html#internal-triggers">Internal Triggers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sensors.html#creating-a-sensor">Creating a Sensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sensors.html#how-sensors-are-run">How Sensors are Run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sensors.html#sensor-service">Sensor Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sensors.html#common-operations">Common Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sensors.html#datastore-management-operations">Datastore Management Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sensors.html#running-your-first-sensor">Running Your First Sensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sensors.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sensors.html#debugging-a-sensor-from-a-pack">Debugging a Sensor From a Pack</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../rules.html">Rules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../rules.html#rule-structure">Rule Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rules.html#trigger">Trigger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rules.html#criteria">Criteria</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rules.html#critera-comparison">Critera Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rules.html#advanced-comparison">Advanced Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rules.html#action">Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rules.html#variable-interpolation">Variable Interpolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rules.html#managing-rules">Managing Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rules.html#rule-location">Rule Location</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rules.html#testing-rules">Testing Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rules.html#timers">Timers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../workflows.html">Workflows</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../actionchain.html">ActionChain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mistral.html">Mistral</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mistral_yaql.html">Mistral + YAQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mistral_jinja.html">Mistral + Jinja</a></li>
<li class="toctree-l2"><a class="reference internal" href="../orchestra/index.html">Orchestra</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../packs.html">Packs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../packs.html#what-is-a-pack">What is a Pack?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packs.html#managing-packs">Managing Packs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packs.html#discovering-packs">Discovering Packs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packs.html#installing-a-pack">Installing a Pack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packs.html#configuring-a-pack">Configuring a Pack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packs.html#developing-a-pack">Developing a Pack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packs.html#advanced-topics">Advanced Topics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webhooks.html">Webhooks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../webhooks.html#sensors-vs-webhooks">Sensors vs Webhooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webhooks.html#authentication">認証(Authentication)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webhooks.html#id2">リクエストボディ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webhooks.html#webhook">Webhook の登録</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webhooks.html#generic-webhook">Generic Webhook の使用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webhooks.html#id3">登録済み Webhook の一覧表示</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webhooks.html#id4">Webhook がうまく動かない場合</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webhooks.html#id5">Webhook を使わない場合</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../datastore.html">データストア</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../datastore.html#cli-key-value">CLI による Key-Value ペアの登録と取得方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastore.html#cli">CLI からの数値、オブジェクト、配列値の登録・取得</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastore.html#key-value">ファイルから key-value ペアを読み込む方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastore.html#datastore-scopes-in-key-value-store">データのスコープ設定</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastore.html#ttl">登録データの TTL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastore.html#python-client">Python Client から値を設定・取得</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastore.html#referencing-key-value-pairs-in-action-definitions">アクション定義ファイルから key-value ペアを取得する方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastore.html#id4">ルール定義ファイルから key-value ペアを参照する</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastore.html#admin-setup-for-encrypted-datastore">登録データの暗号化設定 (管理者のみ)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastore.html#datastore-storing-secrets-in-key-value-store">暗号化データの保存</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datastore.html#id7">セキュリティノート</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chatops/index.html">ChatOps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../chatops/chatops.html">What is ChatOps?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/chatops.html#architecture">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/chatops.html#stackstorm-flavored-chatops">StackStorm-flavored ChatOps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/chatops.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/chatops.html#adding-new-chatops-commands">Adding New ChatOps Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/chatops.html#logging">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/aliases.html">Action Aliases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/notifications.html">Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatops/pack_deploy.html">Pack Deployment</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">応用トピック</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../authentication.html">Authentication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../authentication.html#configuring-the-service">Configuring the Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../authentication.html#standalone-auth-mode">Standalone Auth Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../authentication.html#proxy-auth-mode">Proxy Auth Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../authentication.html#auth-backends">Auth Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../authentication.html#ldap-enterprise-edition">LDAP (Enterprise Edition)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../authentication.html#running-the-service">Running the Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../authentication.html#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../authentication.html#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../authentication.html#api-keys">API Keys</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../rbac.html">Role Based Access Control</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../rbac.html#terminology">Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbac.html#system-roles">System Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbac.html#how-it-works">How it Works</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbac.html#enabling-rbac">Enabling RBAC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbac.html#defining-roles-and-assignments">Defining Roles and Assignments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbac.html#applying-rbac-definitions">Applying RBAC Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbac.html#automatically-granting-roles-based-on-ldap-group-membership">Automatically Granting Roles Based on LDAP Group Membership</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbac.html#restricting-users-to-only-view-resources-they-own-or-created">Restricting Users to Only View Resources They Own or Created</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rbac.html#using-rbac-example">Using RBAC Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../inquiries.html">Inquiries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../inquiries.html#new-core-ask-action">New <code class="docutils literal notranslate"><span class="pre">core.ask</span></code> Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="../inquiries.html#using-core-ask-in-a-workflow">Using <code class="docutils literal notranslate"><span class="pre">core.ask</span></code> in a Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../inquiries.html#notifying-users-of-inquiries-using-rules">Notifying Users of Inquiries using Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../inquiries.html#responding-to-an-inquiry">Responding to an Inquiry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../inquiries.html#securing-inquiries">Securing Inquiries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../inquiries.html#garbage-collection-for-inquiries">Garbage Collection for Inquiries</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">References and Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sharing_code_sensors_actions.html">Sharing code between Sensors and Python Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html">CLI Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="pack_configs.html">Pack Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="packs.html">Create and Contribute a Pack</a></li>
<li class="toctree-l2"><a class="reference internal" href="pack_management_transition.html">Pack Management Transition</a></li>
<li class="toctree-l2"><a class="reference internal" href="action_output_streaming.html">Real-time Action Output Streaming</a></li>
<li class="toctree-l2"><a class="reference internal" href="content_version.html">Using a Specific Version of Pack Content When Running an Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="jinja.html">Jinja</a></li>
<li class="toctree-l2"><a class="reference internal" href="policies.html">Policies</a></li>
<li class="toctree-l2"><a class="reference internal" href="runners.html">Action Runners</a></li>
<li class="toctree-l2"><a class="reference internal" href="traces.html">Traces</a></li>
<li class="toctree-l2"><a class="reference internal" href="client_libraries.html">Client Libraries and Language Bindings</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">High Availability Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">REST API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitoring.html">System Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="sensor_partitioning.html">Partitioning Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html">History and Audit</a></li>
<li class="toctree-l2"><a class="reference internal" href="secrets_masking.html">Secrets Masking</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/self_verification.html">Running Self-Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/basic_chatops_troubleshooting.html">ChatOps Troubleshooting Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/rules.html">Rule is not Being Matched</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/sensors.html">Sensor Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/mistral.html">Mistral Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/ssh.html">SSH Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/database.html">Database Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/rest_api_access.html">REST API access</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/tuning_action_runner_dispatcher_pool.html">Tuning Action Runner Dispatcher Pool Size</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/purging_old_data.html">Purging Old Operational Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/private_networks.html">WebUI Access on Private Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/submit_debug_info.html">Submitting Debugging Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/debug_mode.html">Enabling Debug Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/ask_for_support.html">Ask for help!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/webhooks.html">Troubleshooting Webhooks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/index.html#contributing">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/index.html#setting-up-a-development-environment">Setting up a Development Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/index.html#general-contribution-guidelines">General Contribution Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/index.html#code-style-guide">Code Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/index.html#deprecation-policy">Deprecation Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/index.html#general-coding-guidelines">General Coding Guidelines</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#in-development">in development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#may-16-2018">2.7.2 - May 16, 2018</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#april-20-2018">2.7.1 - April 20, 2018</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#april-12-2018">2.7.0 - April 12, 2018</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#january-19-2018">2.6.0 - January 19, 2018</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#december-14-2017">2.5.1 - December 14, 2017</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#october-25-2017">2.5.0 - October 25, 2017</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#september-12-2017">2.4.1 - September 12, 2017</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#august-23-2017">2.4.0 - August 23, 2017</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#july-28-2017">2.3.2 - July 28, 2017</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#july-07-2017">2.3.1 - July 07, 2017</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#june-19-2017">2.3.0 - June 19, 2017</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#april-3-2017">2.2.1 - April 3, 2017</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#february-27-2017">2.2.0 - February 27, 2017</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#december-16-2016">2.1.1 - December 16, 2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#december-05-2016">2.1.0 - December 05, 2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#september-30-2016">2.0.1 - September 30, 2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#august-31-2016">2.0.0 - August 31, 2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#august-8-2016">1.6.0 - August 8, 2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#july-13-2016">1.5.1 - July 13, 2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#june-24-2016">1.5.0 - June 24, 2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#april-18-2016">1.4.0 - April 18, 2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#february-12-2016">1.3.2 - February 12, 2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#january-25-2016">1.3.1 - January 25, 2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#january-22-2016">1.3.0 - January 22, 2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#december-07-2015">1.2.0 - December 07, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#november-13-2015">1.1.1 - November 13, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#october-27-2015">1.1.0 - October 27, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#september-09-2015">0.13.2 - September 09, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#august-28-2015">0.13.1 - August 28, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#august-24-2015">0.13.0 - August 24, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#august-11-2015">0.12.2 - August 11, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#july-31-2015">0.12.1 - July 31, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#july-20-2015">0.12.0 - July 20, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#july-2-2015">0.11.6 - July 2, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#july-1-2015">0.11.5 - July 1, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#june-30-2015">0.11.4 - June 30, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#june-16-2015">0.11.3 - June 16, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#june-12-2015">0.11.2 - June 12, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#june-8-2015">0.11.1 - June 8, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#june-5-2015">0.11.0 - June 5, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#v0-9-2-may-26-2015">v0.9.2 - May 26, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#v0-9-1-may-12-2015">v0.9.1 - May 12, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#v0-9-0-april-29-2015">v0.9.0 - April 29, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#v0-8-3-march-23-2015">v0.8.3 - March 23, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#v0-8-2-march-10-2015">v0.8.2 - March 10, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#v0-8-1-march-10-2015">v0.8.1 - March 10, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#v0-8-0-march-2-2015">v0.8.0 - March 2, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#v0-7-january-16-2015">v0.7 - January 16, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#v0-6-0-december-8-2014">v0.6.0 - December 8, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#v0-5-1-november-3rd-2014">v0.5.1 - November 3rd, 2014</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade_notes.html">Upgrade Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v2-7">StackStorm v2.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v2-6">StackStorm v2.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v2-5">StackStorm v2.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v2-4">StackStorm v2.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v2-3">StackStorm v2.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v2-2">StackStorm v2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v2-1">StackStorm v2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v2-0">StackStorm v2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v1-6">StackStorm v1.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v1-5">StackStorm v1.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v1-4">StackStorm v1.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v1-3">StackStorm v1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v1-2">StackStorm v1.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v1-1">StackStorm v1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v-0-11">StackStorm v 0.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade_notes.html#st2-v0-9">StackStorm v0.9</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../roadmap.html#eta-june-2018">2.8 - ETA June 2018</a></li>
<li class="toctree-l2"><a class="reference internal" href="../roadmap.html#eta-august-2018">2.9 - ETA August 2018</a></li>
<li class="toctree-l2"><a class="reference internal" href="../roadmap.html#eta-october-2018">3.0 - ETA October 2018</a></li>
<li class="toctree-l2"><a class="reference internal" href="../roadmap.html#backlog">Backlog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../roadmap.html#release-history">Release History</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">StackStorm</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs v2.8dev </a> &raquo;</li>
        
          <li><a href="index.html">References and Guides</a> &raquo;</li>
        
      <li>High Availability Deployment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/StackStorm/st2docs/blob/master/docs/source/reference/ha.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document">
            <div id="version-warning" class="admonition warning hide">
              <p class="first admonition-title">Note</p>
              <p class="last">
                The documentation you're currently reading is for version 2.8dev.
                Click <a href="/">here</a> to view documentation for the latest stable version.
              </p>
            </div>
            
  <div class="section" id="high-availability-deployment">
<h1>High Availability Deployment<a class="headerlink" href="#high-availability-deployment" title="Permalink to this headline">¶</a></h1>
<p>StackStorm has been systematically built with High availability(HA) as a goal. The exact deployment
steps to achieve HA depend on the specifics of the infrastructure in which StackStorm is deployed. This
guide covers a brief explanation on various StackStorm services, how they interact and the external
services necessary for StackStorm to function. Note that StackStorm components also scale horizontally thus
increasing the system throughput while achieving higher availability.</p>
<p>In the section <a class="reference internal" href="../install/overview.html"><span class="doc">Overview: Single-box Reference Deployment</span></a> a detailed picture and explanation of how single-box
deployments work is provided. Let’s reproduce the picture here, to keep some context, and use it as
a reference to layer on some HA deployment-specific details.</p>
<div class="figure align-center">
<img alt="../_images/st2-deployment-big-picture.png" src="../_images/st2-deployment-big-picture.png" />
</div>
<div class="section" id="components">
<h2>Components<a class="headerlink" href="#components" title="Permalink to this headline">¶</a></h2>
<p>First, a review of StackStorm components:</p>
<div class="section" id="st2api">
<h3>st2api<a class="headerlink" href="#st2api" title="Permalink to this headline">¶</a></h3>
<p>This process hosts the REST API endpoints that serve requests from WebUI, CLI and ChatOps. It
maintains connections to MongoDB to store and retrieve information. It also connects to RabbitMQ
to push messages onto the message bus. It is a Python WSGI app running under a gunicorn-managed
process which by default listens on port <code class="docutils literal notranslate"><span class="pre">9101</span></code>. It is front-ended by Nginx, acting as a reverse
proxy.</p>
<p>Multiple <code class="docutils literal notranslate"><span class="pre">st2api</span></code> processes can be behind a load balancer in an active-active configuration.
Each of these processes can be deployed on separate compute instances.</p>
</div>
<div class="section" id="st2auth">
<h3>st2auth<a class="headerlink" href="#st2auth" title="Permalink to this headline">¶</a></h3>
<p>All authentication is managed by this process. This process needs a connection to MongoDB and an
authentication backend. See <a class="reference internal" href="../authentication.html#ref-auth-backends"><span class="std std-ref">authentication backends</span></a> for more
information. It is a Python WSGI app running under a gunicorn-managed process which by default
listens on port <code class="docutils literal notranslate"><span class="pre">9100</span></code>. It is front-ended by Nginx acting as a reverse proxy.</p>
<p>Multiple <code class="docutils literal notranslate"><span class="pre">st2auth</span></code> processes can be behind a load balancer in an active-active configuration.
Each of these processes can be deployed on separate compute instances. If using the PAM
authentication backend, special care has to be taken to guarantee that all boxes on which an
instance of <code class="docutils literal notranslate"><span class="pre">st2auth</span></code> runs should have the same users. Generally, all <code class="docutils literal notranslate"><span class="pre">st2auth</span></code> process should
see the same identities, via some provider if applicable, for the system to work predictably.</p>
</div>
<div class="section" id="st2stream">
<h3>st2stream<a class="headerlink" href="#st2stream" title="Permalink to this headline">¶</a></h3>
<p>This process exposes a server-sent event stream. It requires access to both MongoDB and RabbitMQ.
It is also a gunicorn-managed process, listening on port <code class="docutils literal notranslate"><span class="pre">9102</span></code> by default. It is front-ended by
Nginx acting as a reverse proxy. Clients like WebUI and ChatOps maintain a persistent connection
with an <code class="docutils literal notranslate"><span class="pre">st2stream</span></code> process and receive update from the <code class="docutils literal notranslate"><span class="pre">st2stream</span></code> server.</p>
<p>Multiple <code class="docutils literal notranslate"><span class="pre">st2stream</span></code> process can be behind a load balancer in an active-active configuration.
Since clients maintain a persistent connection with a specific instance the client will briefly
lose events if an <code class="docutils literal notranslate"><span class="pre">st2stream</span></code> process goes down. It is the responsibility of the client to
reconnect to an alternate stream connection via the load balancer. Note that this is in contrast
with <code class="docutils literal notranslate"><span class="pre">st2api</span></code> where each connection from a client is short-lived. Take the long-lived nature of
connections made to this process when configuring appropriate timeouts for load balancers, wsgi
app servers like gunicorn etc.</p>
</div>
<div class="section" id="st2sensorcontainer">
<h3>st2sensorcontainer<a class="headerlink" href="#st2sensorcontainer" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">st2sensorcontainer</span></code> manages the sensors to be run on a node. It will start, stop and restart
sensors running on a node. In this case a node is the same as a compute instance i.e. a Virtual
Machine. In future this could be a container.</p>
<p>It is possible to run <code class="docutils literal notranslate"><span class="pre">st2sensorcontainer</span></code> in HA mode by running one process on each compute
instance. Each sensor node needs to be provided with proper partition information to share work
with other sensor nodes so that the same sensor does not run on different nodes.
See <a class="reference internal" href="sensor_partitioning.html"><span class="doc">Partitioning Sensors</span></a> for information on how to partition sensors. Currently
<code class="docutils literal notranslate"><span class="pre">st2sensorcontainer</span></code> processes do not form a cluster and distribute work or take over
new work if some nodes in the cluster disappear. It is possible for a sensor itself to be
implemented with HA in mind so that the same sensor can be deployed on multiple nodes with the
sensor managing active-active or active-passive. Providing some platform level HA support for
sensors is likely to be an enhancement to StackStorm in future releases.</p>
</div>
<div class="section" id="st2rulesengine">
<h3>st2rulesengine<a class="headerlink" href="#st2rulesengine" title="Permalink to this headline">¶</a></h3>
<p>This is a dual purpose process. Its main function is to evaluate rules when it sees
TriggerInstances and decide if an ActionExecution is to be requested. It needs access to MongoDB to
locate rules and RabbitMQ to listen for TriggerInstances and request ActionExecutions. The
auxiliary purpose of this process is to run all the defined timers. See
<a class="reference internal" href="../rules.html#ref-rule-timers"><span class="std std-ref">timers</span></a> for the specifics on setting up timers via rules.</p>
<p>Multiple <code class="docutils literal notranslate"><span class="pre">st2rulesengine</span></code> processes can run in active-active with only connections to MongoDB and
RabbitMQ. All these will share the TriggerInstance load and naturally pick up more work if one or
more of the processes becomes unavailable. The timer function in each of the RulesEngine is not HA
compatible. In the interim it is possible to disable the timer in all but one of the
<code class="docutils literal notranslate"><span class="pre">st2rulesengine</span></code> to avoid duplicate timer events. Expect this to be fixed in a future StackStorm
release.</p>
</div>
<div class="section" id="st2actionrunner">
<h3>st2actionrunner<a class="headerlink" href="#st2actionrunner" title="Permalink to this headline">¶</a></h3>
<p>All ActionExecutions are handled for execution by <code class="docutils literal notranslate"><span class="pre">st2actionrunner</span></code>. It manages the full
life-cycle of an execution from scheduling to one of the terminal states.</p>
<p>Multiple <code class="docutils literal notranslate"><span class="pre">st2actionrunner</span></code> processes can run in active-active with only connections to MongoDB
and RabbitMQ. Work gets naturally distributed across runners via RabbitMQ. Adding more
<code class="docutils literal notranslate"><span class="pre">st2actionrunner</span></code> processes increases the ability of StackStorm to execute actions.</p>
<p>In a proper distributed setup it is recommended to setup Zookeeper or Redis to provide a
distributed co-ordination layer. See <a class="reference internal" href="policies.html"><span class="doc">Policies</span></a>. Using the default
file-based co-ordination backend will not work as it would in a single box deployment.</p>
</div>
<div class="section" id="st2resultstracker">
<h3>st2resultstracker<a class="headerlink" href="#st2resultstracker" title="Permalink to this headline">¶</a></h3>
<p>Tracks results of execution handed over to Mistral. It requires access to MongoDB and RabbitMQ to
perform its function.</p>
<p>Multiple <code class="docutils literal notranslate"><span class="pre">st2resultstracker</span></code> processes will co-operate with each other to perform work. At
startup there is a possibility of extra work however there are no negative consequences of this
duplication. Specifically the jobs to track results also get stored in the DB in case there are no
workers to take over the work. This pattern makes all result trackers pick up the same work set on
startup. Once this work set is exhausted all subsequent tasks are round-robined. If needed
<code class="docutils literal notranslate"><span class="pre">st2resultstracker</span></code> processes could be started in a staggered manner to avoid extra work.</p>
</div>
<div class="section" id="st2notifier">
<h3>st2notifier<a class="headerlink" href="#st2notifier" title="Permalink to this headline">¶</a></h3>
<p>This is a dual purpose process - its main function is to generate <code class="docutils literal notranslate"><span class="pre">st2.core.actiontrigger</span></code> and
<code class="docutils literal notranslate"><span class="pre">st2.core.notifytrigger</span></code> based on the completion of ActionExecution. The auxiliary purpose is to
act as a backup scheduler for actions that may not have been scheduled.</p>
<p>Multiple <code class="docutils literal notranslate"><span class="pre">st2notifier</span></code> processes can run in active-active mode, using connections to RabbitMQ
and MongoDB. For the auxiliary purpose to function in an HA deployment when more than one
<code class="docutils literal notranslate"><span class="pre">st2notifier</span></code> is running, either Zookeeper or Redis is required to provide co-ordination. It is
also possible to designate a single <code class="docutils literal notranslate"><span class="pre">st2notifier</span></code> as provider of auxiliary functions by disabling
the scheduler in all but one <code class="docutils literal notranslate"><span class="pre">st2notifiers</span></code>.</p>
</div>
<div class="section" id="st2garbagecollector">
<h3>st2garbagecollector<a class="headerlink" href="#st2garbagecollector" title="Permalink to this headline">¶</a></h3>
<p>Optional service that cleans up old executions and other operations data based on setup
configurations. By default this process does nothing and needs to be setup to perform any work.</p>
<p>By design it is a singleton process. Running multiple instances in active-active will not yield
much benefit, but will not do any harm. The ideal configuration is active-passive but StackStorm itself
does not provide the ability to run this in active-passive.</p>
</div>
<div class="section" id="mistral-api">
<h3>mistral-api<a class="headerlink" href="#mistral-api" title="Permalink to this headline">¶</a></h3>
<p>Mistral API is served by this aptly named process. It needs access to PostgreSQL and RabbitMQ.</p>
<p>Multiple <code class="docutils literal notranslate"><span class="pre">mistral-api</span></code> processes can run in an active-active configuration by using a load
balancer to distribute at its front end. This is similar to <code class="docutils literal notranslate"><span class="pre">st2api</span></code>. In a typical single box
deployment <code class="docutils literal notranslate"><span class="pre">mistral-api</span></code> is local to the box and StackStorm communicates via a direct HTTP connection.
For HA setup we recommend putting <code class="docutils literal notranslate"><span class="pre">mistral-api</span></code> behind a load balancer and setting up StackStorm to
communicate via the load balancer.</p>
</div>
<div class="section" id="mistral-server">
<h3>mistral-server<a class="headerlink" href="#mistral-server" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">mistral-server</span></code> is the worker engine for mistral i.e. the process which actually manages
executions. The StackStorm plugin to mistral (<code class="docutils literal notranslate"><span class="pre">st2mistral</span></code>) communicates back to the StackStorm API. This
process needs access to PostgreSQL and RabbitMQ.</p>
<p>Multiple <code class="docutils literal notranslate"><span class="pre">mistral-server</span></code> processes can run and co-ordinate work in an active-active
configuration. In an HA deployment all communication with the StackStorm API must be via the configured
load balancer.</p>
</div>
</div>
<div class="section" id="required-dependencies">
<h2>Required Dependencies<a class="headerlink" href="#required-dependencies" title="Permalink to this headline">¶</a></h2>
<p>This section has some HA recommendations for the dependencies required by StackStorm components. This
should serve as a guide only. The exact configuration will depend upon the site infrastructure.</p>
<div class="section" id="mongodb">
<h3>MongoDB<a class="headerlink" href="#mongodb" title="Permalink to this headline">¶</a></h3>
<p>StackStorm uses this to cache Actions, Rules and Sensor metadata which already live in the filesystem.
All the content should ideally be source-control managed, preferably in a git repository. StackStorm
also stores operational data like ActionExecution, TriggerInstance etc. The Key-Value datastore
contents are also maintained in MongoDB.</p>
<p>MongoDB supports <a class="reference external" href="https://docs.mongodb.org/v3.4/core/replica-set-high-availability/">replica set high-availability</a>, which we recommend to
provide safe failover. See <a class="reference internal" href="../install/config/config.html#ref-mongo-ha-config"><span class="std std-ref">here</span></a> for how to configure StackStorm to connect
to MongoDB replica sets.</p>
<p>Loss of connectivity to a MongoDB cluster will cause downtime for StackStorm. However, once a replica
MongoDB is brought back it should be possible to bring StackStorm back to operational state by
simply loading the content (through <code class="docutils literal notranslate"><span class="pre">st2ctl</span> <span class="pre">reload</span> <span class="pre">--register-all</span></code> and <code class="docutils literal notranslate"><span class="pre">st2</span> <span class="pre">key</span> <span class="pre">load</span></code>. Easy
access to old ActionExecutions will be lost but all the data of old ActionExecutions will still
be available in audit logs.</p>
</div>
<div class="section" id="postgresql">
<h3>PostgreSQL<a class="headerlink" href="#postgresql" title="Permalink to this headline">¶</a></h3>
<p>Used primarily by <code class="docutils literal notranslate"><span class="pre">mistral-api</span></code> and <code class="docutils literal notranslate"><span class="pre">mistral-server</span></code>. To deploy PostgreSQL in HA please see
<a class="reference external" href="http://www.postgresql.org/docs/9.4/static/high-availability.html">the PostgreSQL documentation</a>.</p>
<p>The data stored in PostgreSQL is operational for Mistral, therefore starting from a brand new
PostgreSQL in case of loss of a cluster will bring automation services back instantly. There will
be downtime while a new DB cluster is provisioned.</p>
</div>
<div class="section" id="rabbitmq">
<h3>RabbitMQ<a class="headerlink" href="#rabbitmq" title="Permalink to this headline">¶</a></h3>
<p>RabbitMQ is the communication hub for StackStorm to co-ordinate and distribute work. See
<a class="reference external" href="https://www.rabbitmq.com/ha.html">RabbitMQ documentation</a> to understand HA deployment
strategies.</p>
<p>Our recommendation is to mirror all the Queues and Exchanges so that the loss of one server does
not affect functionality.</p>
<p>See <a class="reference internal" href="../install/config/config.html#ref-rabbitmq-cluster-config"><span class="std std-ref">here</span></a> for how to configure StackStorm to connect to a RabbitMQ
cluster.</p>
</div>
<div class="section" id="zookeeper-redis">
<h3>Zookeeper/Redis<a class="headerlink" href="#zookeeper-redis" title="Permalink to this headline">¶</a></h3>
<p>Various StackStorm features rely on a proper co-ordination backend in a distributed deployment to work
correctly.</p>
<p><a class="reference external" href="http://zookeeper.apache.org/doc/trunk/zookeeperStarted.html#sc_RunningReplicatedZooKeeper">This</a>
shows how to run a replicated Zookeeper setup. See <a class="reference external" href="http://redis.io/topics/sentinel">this</a> to
understand Redis deployments using sentinel.</p>
</div>
<div class="section" id="nginx-and-load-balancing">
<h3>Nginx and Load Balancing<a class="headerlink" href="#nginx-and-load-balancing" title="Permalink to this headline">¶</a></h3>
<p>An load balancer is required to reverse proxy each instance of <code class="docutils literal notranslate"><span class="pre">st2api</span></code>, <code class="docutils literal notranslate"><span class="pre">st2auth</span></code>,
<code class="docutils literal notranslate"><span class="pre">st2stream</span></code> and <code class="docutils literal notranslate"><span class="pre">mistral-api</span></code>. In the reference setup, Nginx is used for this. This server
terminates SSL connections, shields clients from internal port numbers of various services
and only require ports 80 and 443 to be open on containers.</p>
<p>Often it is best to deploy one set of all these services on a compute instance and share an Nginx
server.</p>
<p>There is also a need for a load balancer to frontend all the REST services. This results in an HA
deployment for REST services as well as single endpoint for clients. Most deployment
infrastructures will already have a load balancer solution which they would prefer to use so we do
not provide any specific recommendations.</p>
</div>
</div>
<div class="section" id="sharing-content">
<h2>Sharing Content<a class="headerlink" href="#sharing-content" title="Permalink to this headline">¶</a></h2>
<p>In an HA setup with <code class="docutils literal notranslate"><span class="pre">st2api</span></code>, <code class="docutils literal notranslate"><span class="pre">st2actionrunner</span></code> and <code class="docutils literal notranslate"><span class="pre">st2sensorcontainer</span></code> each running on
multiple boxes the question of managing distributed content is crucial. StackStorm does not provide a
built-in solution to distributing content on various boxes. Instead it relies on external
management of StackStorm content. Here are a few strategies:</p>
<div class="section" id="read-write-nfs-mounts">
<h3>Read-Write NFS mounts<a class="headerlink" href="#read-write-nfs-mounts" title="Permalink to this headline">¶</a></h3>
<p>If the content folders i.e. <code class="docutils literal notranslate"><span class="pre">/opt/stackstorm/packs</span></code> and <code class="docutils literal notranslate"><span class="pre">/opt/stackstorm/virtualenvs</span></code> are
placed on read-write NFS mounts then writes from any StackStorm node will be visible to other nodes.
Special care needs to be taken with <code class="docutils literal notranslate"><span class="pre">/opt/stackstorm/virtualenvs</span></code> since that has symlinks to
system libraries. If care is not taken to provision all host boxes in an identical manner it could
lead to unpredictable behavior. Managing the <code class="docutils literal notranslate"><span class="pre">virtualenvs</span></code> on every host box individually would
be a more robust approach.</p>
</div>
<div class="section" id="content-management">
<h3>Content management<a class="headerlink" href="#content-management" title="Permalink to this headline">¶</a></h3>
<p>Manage pack installation using a configuration management tool of your choice, such as Ansible,
Puppet, Chef, or Salt. Assuming that the list of packs to be deployed will be static, then
deploying content to StackStorm nodes via CM tools could be a sub-step of an overall StackStorm deployment.
This is perhaps the better of the two approaches to end up with a predictable HA deployment.</p>
</div>
</div>
<div class="section" id="reference-ha-setup">
<h2>Reference HA setup<a class="headerlink" href="#reference-ha-setup" title="Permalink to this headline">¶</a></h2>
<p>In this section we provide a highly opinionated and therefore prescriptive approach to deploying
StackStorm in HA. This deployment has 3 independent boxes which we categorize as “controller box” and
“blueprint box.” We’ll call these boxes <code class="docutils literal notranslate"><span class="pre">st2-multi-node-cntl</span></code>, <code class="docutils literal notranslate"><span class="pre">st2-multi-node-1</span></code> and
<code class="docutils literal notranslate"><span class="pre">st2-multi-node-2</span></code>. For the sake of reference we will be using Ubuntu 14.04 as the base OS.
Obviously you can also use RedHat/CentOS.</p>
<div class="figure align-center" id="id1">
<img alt="../_images/st2-deployment-multi-node.png" src="../_images/st2-deployment-multi-node.png" />
<p class="caption"><span class="caption-text">StackStorm HA reference deployment.</span></p>
</div>
<div class="section" id="controller-box">
<h3>Controller Box<a class="headerlink" href="#controller-box" title="Permalink to this headline">¶</a></h3>
<p>This box runs all the shared required dependencies and some StackStorm components:</p>
<ul class="simple">
<li>Nginx as load balancer</li>
<li>MongoDB</li>
<li>PostgreSQL</li>
<li>RabbitMQ</li>
<li>st2chatops</li>
<li>st2web</li>
</ul>
<p>In practice <code class="docutils literal notranslate"><span class="pre">MongoDB</span></code>, <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> and <code class="docutils literal notranslate"><span class="pre">RabbitMQ</span></code> will usually be on standalone clusters
managed outside of StackStorm. The two shared components (<code class="docutils literal notranslate"><span class="pre">st2chatops</span></code> and <code class="docutils literal notranslate"><span class="pre">st2web</span></code>) are placed here
for the sake of convenience. They could be placed anywhere with the right configuration.</p>
<p>The Nginx load balancer can easily be switched out for Amazon ELB, HAProxy or any other of your
choosing. In that case <code class="docutils literal notranslate"><span class="pre">st2web</span></code> which is being served off this Nginx instance will also need a
new home.</p>
<p><code class="docutils literal notranslate"><span class="pre">st2chatops</span></code> which uses <code class="docutils literal notranslate"><span class="pre">hubot</span></code> is not easily deployed in HA. Using something like
<a class="reference external" href="http://www.keepalived.org/">keepalived</a> to maintain <code class="docutils literal notranslate"><span class="pre">st2chatops</span></code> in active-passive
configuration is an option.</p>
<p>Follow these steps to provision a controller box on Ubuntu 14.04:</p>
<div class="section" id="install-required-dependencies">
<h4>Install Required Dependencies<a class="headerlink" href="#install-required-dependencies" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Install <code class="docutils literal notranslate"><span class="pre">MongoDB</span></code>, <code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code> and <code class="docutils literal notranslate"><span class="pre">RabbitMQ</span></code>:</li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install -y mongodb-server rabbitmq-server postgresql
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">Fix the listen address in <code class="docutils literal notranslate"><span class="pre">/etc/postgresql/9.3/main/postgresql.conf</span></code> and have PostgreSQL
listen on an interface that has an IP address reachable from <code class="docutils literal notranslate"><span class="pre">st2-multi-node-1</span></code> and
<code class="docutils literal notranslate"><span class="pre">st2-multi-node-2</span></code>.</p>
</li>
<li><p class="first">Fix <code class="docutils literal notranslate"><span class="pre">bind_ip</span></code> in <code class="docutils literal notranslate"><span class="pre">/etc/mongodb.conf</span></code> to bind MongoDB to an interface that has an IP address
reachable from <code class="docutils literal notranslate"><span class="pre">st2-multi-node-1</span></code> and <code class="docutils literal notranslate"><span class="pre">st2-multi-node-2</span></code>.</p>
</li>
<li><p class="first">Restart MongoDB:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo service mongodb restart
</pre></div>
</div>
</li>
<li><p class="first">Add an ACL rule to <code class="docutils literal notranslate"><span class="pre">/etc/postgresql/9.3/main/pg_hba.conf</span></code>. In this example we’re allowing
access from the subnet <code class="docutils literal notranslate"><span class="pre">10.0.3.0/24</span></code></p>
</li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>host       all  all  <span class="m">10</span>.0.3.0/24  trust
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="6">
<li>Restart PostgreSQL:</li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo service postgresql restart
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="7">
<li>Create Mistral DB in PostgreSQL:</li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cat <span class="s">&lt;&lt; EHD | sudo -u postgres psql</span>
<span class="s">CREATE ROLE mistral WITH CREATEDB LOGIN ENCRYPTED PASSWORD &#39;StackStorm&#39;;</span>
<span class="s">CREATE DATABASE mistral OWNER mistral;</span>
<span class="s">EHD</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="8">
<li>Add stable StackStorm repos:</li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -s https://packagecloud.io/install/repositories/StackStorm/staging-stable/script.deb.sh <span class="p">|</span> sudo bash
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="9">
<li>Setup <code class="docutils literal notranslate"><span class="pre">st2web</span></code> and SSL termination. Follow <a class="reference internal" href="../install/deb.html#ref-install-webui-ssl-deb"><span class="std std-ref">install webui and setup
ssl</span></a>. You will need to stop after removing the default Nginx config
file.</li>
<li>A sample configuration for Nginx as load balancer for the controller box is provided below.
With this configuration Nginx will load balance all requests between the two blueprint boxes
<code class="docutils literal notranslate"><span class="pre">st2-multi-node-1</span></code> and <code class="docutils literal notranslate"><span class="pre">st2-multi-node-2</span></code>. This includes requests to <code class="docutils literal notranslate"><span class="pre">st2api</span></code>,
<code class="docutils literal notranslate"><span class="pre">st2auth</span></code> and <code class="docutils literal notranslate"><span class="pre">mistral-api</span></code>. Nginx also serves as the webserver for <code class="docutils literal notranslate"><span class="pre">st2web</span></code>.</li>
</ol>
<blockquote>
<div><div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># nginx configuration to expose st2 webui, redirect HTTP-&gt;HTTPS,</span>
<span class="c1"># provide SSL termination, and reverse-proxy st2api and st2auth API endpoint.</span>
<span class="c1"># To enable:</span>
<span class="c1">#    cp ${LOCATION}/st2.conf /etc/nginx/sites-available</span>
<span class="c1">#    ln -l /etc/nginx/sites-available/st2.conf /etc/nginx/sites-enabled/st2.conf</span>
<span class="c1"># see https://docs.stackstorm.com/install.html for details</span>

<span class="k">upstream</span> <span class="s">st2</span> <span class="p">{</span>
  <span class="kn">server</span> <span class="n">st2-multi-node-1</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>
  <span class="kn">server</span> <span class="n">st2-multi-node-2</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span> <span class="s">*:80</span> <span class="s">default_server</span><span class="p">;</span>

  <span class="kn">add_header</span> <span class="s">Front-End-Https</span> <span class="no">on</span><span class="p">;</span>
  <span class="kn">add_header</span> <span class="s">X-Content-Type-Options</span> <span class="s">nosniff</span><span class="p">;</span>

  <span class="kn">if</span> <span class="s">(</span><span class="nv">$ssl_protocol</span> <span class="p">=</span> <span class="s">&quot;&quot;)</span> <span class="p">{</span>
       <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kn">index</span>  <span class="s">index.html</span> <span class="s">index.htm</span> <span class="s">index.php</span><span class="p">;</span>

  <span class="kn">access_log</span> <span class="s">/var/log/nginx/st2webui.access.log</span> <span class="s">combined</span><span class="p">;</span>
  <span class="kn">error_log</span> <span class="s">/var/log/nginx/st2webui.error.log</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span>       <span class="s">*:443</span> <span class="s">ssl</span><span class="p">;</span>

  <span class="kn">ssl</span> <span class="no">on</span><span class="p">;</span>

  <span class="kn">ssl_certificate</span>           <span class="s">/etc/ssl/st2/st2.crt</span><span class="p">;</span>
  <span class="kn">ssl_certificate_key</span>       <span class="s">/etc/ssl/st2/st2.key</span><span class="p">;</span>
  <span class="kn">ssl_session_cache</span>         <span class="s">shared:SSL:10m</span><span class="p">;</span>
  <span class="kn">ssl_session_timeout</span>       <span class="mi">5m</span><span class="p">;</span>
  <span class="kn">ssl_protocols</span>             <span class="s">TLSv1</span> <span class="s">TLSv1.1</span> <span class="s">TLSv1.2</span><span class="p">;</span>
  <span class="kn">ssl_ciphers</span>               <span class="s">EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH:ECDHE-RSA-AES128-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA128:DHE-RSA-AES128-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA128:ECDHE-RSA-AES128-SHA384:ECDHE-RSA-AES128-SHA128:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA128:DHE-RSA-AES128-SHA128:DHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA384:AES128-GCM-SHA128:AES128-SHA128:AES128-SHA128:AES128-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4</span><span class="p">;</span>
  <span class="kn">ssl_prefer_server_ciphers</span> <span class="no">on</span><span class="p">;</span>

  <span class="kn">index</span>  <span class="s">index.html</span> <span class="s">index.htm</span> <span class="s">index.php</span><span class="p">;</span>

  <span class="kn">access_log</span>            <span class="s">/var/log/nginx/ssl-st2webui.access.log</span> <span class="s">combined</span><span class="p">;</span>
  <span class="kn">error_log</span>             <span class="s">/var/log/nginx/ssl-st2webui.error.log</span><span class="p">;</span>

  <span class="kn">add_header</span>              <span class="s">Front-End-Https</span> <span class="no">on</span><span class="p">;</span>
  <span class="kn">add_header</span>              <span class="s">X-Content-Type-Options</span> <span class="s">nosniff</span><span class="p">;</span>

  <span class="kn">location</span> <span class="s">/api/</span> <span class="p">{</span>
    <span class="kn">rewrite</span> <span class="s">^/api/(.*)</span>  <span class="s">/api/</span><span class="nv">$1</span> <span class="s">break</span><span class="p">;</span>

    <span class="kn">proxy_pass</span>            <span class="s">https://st2/api/</span><span class="p">;</span>
    <span class="kn">proxy_read_timeout</span>    <span class="mi">90</span><span class="p">;</span>
    <span class="kn">proxy_connect_timeout</span> <span class="mi">90</span><span class="p">;</span>
    <span class="kn">proxy_redirect</span>        <span class="no">off</span><span class="p">;</span>

    <span class="kn">proxy_set_header</span>      <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span>      <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span>      <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>

    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
    <span class="kn">chunked_transfer_encoding</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_cache</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kn">location</span> <span class="s">/auth/</span> <span class="p">{</span>
    <span class="kn">rewrite</span> <span class="s">^/auth/(.*)</span>  <span class="s">/auth/</span><span class="nv">$1</span> <span class="s">break</span><span class="p">;</span>

    <span class="kn">proxy_pass</span>            <span class="s">https://st2/auth/</span><span class="p">;</span>
    <span class="kn">proxy_read_timeout</span>    <span class="mi">90</span><span class="p">;</span>
    <span class="kn">proxy_connect_timeout</span> <span class="mi">90</span><span class="p">;</span>
    <span class="kn">proxy_redirect</span>        <span class="no">off</span><span class="p">;</span>

    <span class="kn">proxy_set_header</span>      <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span>      <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span>      <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
    <span class="kn">proxy_pass_header</span>     <span class="s">Authorization</span><span class="p">;</span>

    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
    <span class="kn">chunked_transfer_encoding</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_cache</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="kn">location</span> <span class="s">/mistral/</span> <span class="p">{</span>
    <span class="kn">rewrite</span> <span class="s">^/mistral/(.*)</span>  <span class="s">/mistral/</span><span class="nv">$1</span> <span class="s">break</span><span class="p">;</span>

    <span class="kn">proxy_pass</span>            <span class="s">https://st2/mistral/</span><span class="p">;</span>
    <span class="kn">proxy_read_timeout</span>    <span class="mi">90</span><span class="p">;</span>
    <span class="kn">proxy_connect_timeout</span> <span class="mi">90</span><span class="p">;</span>
    <span class="kn">proxy_redirect</span>        <span class="no">off</span><span class="p">;</span>

    <span class="kn">proxy_set_header</span>      <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span>      <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span>      <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
    <span class="kn">proxy_pass_header</span>     <span class="s">Authorization</span><span class="p">;</span>

    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
    <span class="kn">chunked_transfer_encoding</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_cache</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
    <span class="kn">root</span>      <span class="s">/opt/stackstorm/static/webui/</span><span class="p">;</span>
    <span class="kn">index</span>     <span class="s">index.html</span> <span class="s">index.htm</span> <span class="s">index.php</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="11">
<li>Create the st2 logs directory and the st2 user:</li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p /var/log/st2
useradd st2
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="12">
<li>Install <code class="docutils literal notranslate"><span class="pre">st2chatops</span></code> following <a class="reference internal" href="../install/deb.html#ref-setup-chatops-deb"><span class="std std-ref">setup chatops</span></a>.</li>
</ol>
</div>
</div>
<div class="section" id="blueprint-box">
<h3>Blueprint box<a class="headerlink" href="#blueprint-box" title="Permalink to this headline">¶</a></h3>
<p>This box is a repeatable StackStorm image that is essentially the single-box reference deployment with a
few changes. The aim is to deploy as many of these boxes for desired HA objectives and horizontal
scaling. StackStorm processes outlined above can be turned on/off individually, therefore each box can
also be made to offer different services.</p>
<ol class="arabic simple">
<li>Add stable StackStorm repos:</li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -s https://packagecloud.io/install/repositories/StackStorm/staging-stable/script.deb.sh <span class="p">|</span> sudo bash
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Install all StackStorm components and mistral:</li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install -y st2 st2mistral
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>Install Nginx:</li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install -y nginx
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Update Mistral connection to PostgreSQL in <code class="docutils literal notranslate"><span class="pre">/etc/mistral/mistral.conf</span></code> by changing the
<code class="docutils literal notranslate"><span class="pre">database.connection</span></code> property.</li>
<li>Update Mistral connection to RabbitMQ in <code class="docutils literal notranslate"><span class="pre">/etc/mistral/mistral.conf</span></code> by changing  the
<code class="docutils literal notranslate"><span class="pre">default.transport_url</span></code> property.</li>
<li>Setup Mistral database:</li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ /opt/stackstorm/mistral/bin/mistral-db-manage --config-file /etc/mistral/mistral.conf upgrade head
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="7">
<li>Register mistral actions:</li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ /opt/stackstorm/mistral/bin/mistral-db-manage --config-file /etc/mistral/mistral.conf populate <span class="p">|</span> grep -v -e openstack -e keystone
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="8">
<li>Replace <code class="docutils literal notranslate"><span class="pre">/etc/st2/st2.conf</span></code> with the sample <code class="docutils literal notranslate"><span class="pre">st2.conf</span></code> provided below. This config points to
the controller node or configuration values of <code class="docutils literal notranslate"><span class="pre">database</span></code>, <code class="docutils literal notranslate"><span class="pre">messaging</span></code> and <code class="docutils literal notranslate"><span class="pre">mistral</span></code>.</li>
</ol>
<blockquote>
<div><div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># System-wide configuration</span>

<span class="k">[api]</span>
<span class="c1"># Host and port to bind the API server.</span>
<span class="na">host</span> <span class="o">=</span> <span class="s">127.0.0.1</span>
<span class="na">port</span> <span class="o">=</span> <span class="s">9101</span>
<span class="na">logging</span> <span class="o">=</span> <span class="s">/etc/st2/logging.api.conf</span>
<span class="na">mask_secrets</span> <span class="o">=</span> <span class="s">True</span>
<span class="c1"># allow_origin is required for handling CORS in st2 web UI.</span>
<span class="c1"># allow_origin = http://myhost1.example.com:3000,http://myhost2.example.com:3000</span>

<span class="k">[sensorcontainer]</span>
<span class="na">logging</span> <span class="o">=</span> <span class="s">/etc/st2/logging.sensorcontainer.conf</span>

<span class="k">[rulesengine]</span>
<span class="na">logging</span> <span class="o">=</span> <span class="s">/etc/st2/logging.rulesengine.conf</span>

<span class="k">[actionrunner]</span>
<span class="na">logging</span> <span class="o">=</span> <span class="s">/etc/st2/logging.actionrunner.conf</span>
<span class="na">virtualenv_opts</span> <span class="o">=</span> <span class="s">--always-copy</span>

<span class="k">[resultstracker]</span>
<span class="na">logging</span> <span class="o">=</span> <span class="s">/etc/st2/logging.resultstracker.conf</span>

<span class="k">[notifier]</span>
<span class="na">logging</span> <span class="o">=</span> <span class="s">/etc/st2/logging.notifier.conf</span>

<span class="k">[exporter]</span>
<span class="na">logging</span> <span class="o">=</span> <span class="s">/etc/st2/logging.exporter.conf</span>

<span class="k">[garbagecollector]</span>
<span class="na">logging</span> <span class="o">=</span> <span class="s">/etc/st2/logging.garbagecollector.conf</span>

<span class="k">[auth]</span>
<span class="na">host</span> <span class="o">=</span> <span class="s">127.0.0.1</span>
<span class="na">port</span> <span class="o">=</span> <span class="s">9100</span>
<span class="na">use_ssl</span> <span class="o">=</span> <span class="s">False</span>
<span class="na">debug</span> <span class="o">=</span> <span class="s">False</span>
<span class="na">enable</span> <span class="o">=</span> <span class="s">True</span>
<span class="na">logging</span> <span class="o">=</span> <span class="s">/etc/st2/logging.auth.conf</span>

<span class="na">mode</span> <span class="o">=</span> <span class="s">standalone</span>

<span class="c1"># Note: Settings below are only used in &quot;standalone&quot; mode</span>
<span class="na">backend</span> <span class="o">=</span> <span class="s">flat_file</span>
<span class="na">backend_kwargs</span> <span class="o">=</span> <span class="s">{&quot;file_path&quot;: &quot;/etc/st2/htpasswd&quot;}</span>

<span class="c1"># Base URL to the API endpoint excluding the version (e.g. http://myhost.net:9101/)</span>
<span class="na">api_url</span> <span class="o">=</span>

<span class="k">[system]</span>
<span class="na">base_path</span> <span class="o">=</span> <span class="s">/opt/stackstorm</span>

<span class="k">[syslog]</span>
<span class="na">host</span> <span class="o">=</span> <span class="s">st2-multi-node-controller</span>
<span class="na">port</span> <span class="o">=</span> <span class="s">514</span>
<span class="na">facility</span> <span class="o">=</span> <span class="s">local7</span>
<span class="na">protocol</span> <span class="o">=</span> <span class="s">udp</span>

<span class="k">[log]</span>
<span class="na">excludes</span> <span class="o">=</span> <span class="s">requests,paramiko</span>
<span class="na">redirect_stderr</span> <span class="o">=</span> <span class="s">False</span>
<span class="na">mask_secrets</span> <span class="o">=</span> <span class="s">True</span>

<span class="k">[system_user]</span>
<span class="na">user</span> <span class="o">=</span> <span class="s">stanley</span>
<span class="na">ssh_key_file</span> <span class="o">=</span> <span class="s">/home/stanley/.ssh/stanley_rsa</span>

<span class="k">[messaging]</span>
<span class="na">url</span> <span class="o">=</span> <span class="s">amqp://guest:guest@st2-multi-node-controller:5672/</span>

<span class="k">[ssh_runner]</span>
<span class="na">remote_dir</span> <span class="o">=</span> <span class="s">/tmp</span>
<span class="na">use_paramiko_ssh_runner</span> <span class="o">=</span> <span class="s">True</span>

<span class="k">[database]</span>
<span class="na">host</span> <span class="o">=</span> <span class="s">st2-multi-node-controller</span>

<span class="k">[mistral]</span>
<span class="na">v2_base_url</span> <span class="o">=</span> <span class="s">https://st2-multi-node-controller/mistral/v2</span>
<span class="na">api_url</span> <span class="o">=</span> <span class="s">https://st2-multi-node-controller/api</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="9">
<li>Generate a certificate:</li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo mkdir -p /etc/ssl/st2
$ sudo openssl req -x509 -newkey rsa:2048 -keyout /etc/ssl/st2/st2.key -out /etc/ssl/st2/st2.crt <span class="se">\</span>
  -days XXX -nodes -subj <span class="s2">&quot;/C=US/ST=California/L=Palo Alto/O=StackStorm/OU=Information \</span>
<span class="s2">  Technology/CN=</span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="10">
<li>If you are using self-signed certificates you will need to add <code class="docutils literal notranslate"><span class="pre">insecure</span> <span class="pre">=</span> <span class="pre">true</span></code> to the
<code class="docutils literal notranslate"><span class="pre">mistral</span></code> section of <code class="docutils literal notranslate"><span class="pre">/etc/st2/st2.conf</span></code>.</li>
<li>Configure users &amp; authentication as per <a class="reference internal" href="../install/deb.html#ref-config-auth-deb"><span class="std std-ref">this documentation</span></a>. Make
sure that user configuration on all boxes running <code class="docutils literal notranslate"><span class="pre">st2auth</span></code> is identical. This ensures
consistent authentication from the entire StackStorm install since the request to authenticate a
user can be forwarded by the load balancer to any of the <code class="docutils literal notranslate"><span class="pre">st2auth</span></code> processes.</li>
<li>Use the sample Nginx config that is provided below for the blueprint boxes. In this config
Nginx will act as the SSL termination endpoint for all the REST endpoints exposed by
<code class="docutils literal notranslate"><span class="pre">st2api</span></code>, <code class="docutils literal notranslate"><span class="pre">st2auth</span></code> and <code class="docutils literal notranslate"><span class="pre">mistral-api</span></code>:</li>
</ol>
<blockquote>
<div><div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># nginx configuration to expose st2 webui, redirect HTTP-&gt;HTTPS,</span>
<span class="c1"># provide SSL termination, and reverse-proxy st2api and st2auth API endpoint.</span>
<span class="c1"># To enable:</span>
<span class="c1">#    cp ${LOCATION}/st2.conf /etc/nginx/sites-available</span>
<span class="c1">#    ln -l /etc/nginx/sites-available/st2.conf /etc/nginx/sites-enabled/st2.conf</span>
<span class="c1"># see https://docs.stackstorm.com/install.html for details</span>

<span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span> <span class="s">*:80</span> <span class="s">default_server</span><span class="p">;</span>

  <span class="kn">add_header</span> <span class="s">Front-End-Https</span> <span class="no">on</span><span class="p">;</span>
  <span class="kn">add_header</span> <span class="s">X-Content-Type-Options</span> <span class="s">nosniff</span><span class="p">;</span>

  <span class="kn">if</span> <span class="s">(</span><span class="nv">$ssl_protocol</span> <span class="p">=</span> <span class="s">&quot;&quot;)</span> <span class="p">{</span>
       <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kn">index</span>  <span class="s">index.html</span> <span class="s">index.htm</span> <span class="s">index.php</span><span class="p">;</span>

  <span class="kn">access_log</span> <span class="s">/var/log/nginx/st2webui.access.log</span> <span class="s">combined</span><span class="p">;</span>
  <span class="kn">error_log</span> <span class="s">/var/log/nginx/st2webui.error.log</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span>       <span class="s">*:443</span> <span class="s">ssl</span><span class="p">;</span>

  <span class="kn">ssl</span> <span class="no">on</span><span class="p">;</span>

  <span class="kn">ssl_certificate</span>           <span class="s">/etc/ssl/st2/st2.crt</span><span class="p">;</span>
  <span class="kn">ssl_certificate_key</span>       <span class="s">/etc/ssl/st2/st2.key</span><span class="p">;</span>
  <span class="kn">ssl_session_cache</span>         <span class="s">shared:SSL:10m</span><span class="p">;</span>
  <span class="kn">ssl_session_timeout</span>       <span class="mi">5m</span><span class="p">;</span>
  <span class="kn">ssl_protocols</span>             <span class="s">TLSv1</span> <span class="s">TLSv1.1</span> <span class="s">TLSv1.2</span><span class="p">;</span>
  <span class="kn">ssl_ciphers</span>               <span class="s">EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH:ECDHE-RSA-AES128-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA128:DHE-RSA-AES128-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA128:ECDHE-RSA-AES128-SHA384:ECDHE-RSA-AES128-SHA128:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA128:DHE-RSA-AES128-SHA128:DHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA384:AES128-GCM-SHA128:AES128-SHA128:AES128-SHA128:AES128-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4</span><span class="p">;</span>
  <span class="kn">ssl_prefer_server_ciphers</span> <span class="no">on</span><span class="p">;</span>

  <span class="kn">index</span>  <span class="s">index.html</span> <span class="s">index.htm</span> <span class="s">index.php</span><span class="p">;</span>

  <span class="kn">access_log</span>            <span class="s">/var/log/nginx/ssl-st2webui.access.log</span> <span class="s">combined</span><span class="p">;</span>
  <span class="kn">error_log</span>             <span class="s">/var/log/nginx/ssl-st2webui.error.log</span><span class="p">;</span>

  <span class="kn">add_header</span>              <span class="s">Front-End-Https</span> <span class="no">on</span><span class="p">;</span>
  <span class="kn">add_header</span>              <span class="s">X-Content-Type-Options</span> <span class="s">nosniff</span><span class="p">;</span>

  <span class="kn">location</span> <span class="s">/api/</span> <span class="p">{</span>
    <span class="kn">rewrite</span> <span class="s">^/api/(.*)</span>  <span class="s">/</span><span class="nv">$1</span> <span class="s">break</span><span class="p">;</span>

    <span class="kn">proxy_pass</span>            <span class="s">http://127.0.0.1:9101/</span><span class="p">;</span>
    <span class="kn">proxy_read_timeout</span>    <span class="mi">90</span><span class="p">;</span>
    <span class="kn">proxy_connect_timeout</span> <span class="mi">90</span><span class="p">;</span>
    <span class="kn">proxy_redirect</span>        <span class="no">off</span><span class="p">;</span>

    <span class="kn">proxy_set_header</span>      <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span>      <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span>      <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>

    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
    <span class="kn">chunked_transfer_encoding</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_cache</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kn">location</span> <span class="s">/stream/</span> <span class="p">{</span>
    <span class="kn">rewrite</span> <span class="s">^/stream/(.*)</span>  <span class="s">/</span><span class="nv">$1</span> <span class="s">break</span><span class="p">;</span>

    <span class="kn">proxy_pass</span>            <span class="s">http://127.0.0.1:9102/</span><span class="p">;</span>
    <span class="kn">proxy_read_timeout</span>    <span class="mi">90</span><span class="p">;</span>
    <span class="kn">proxy_connect_timeout</span> <span class="mi">90</span><span class="p">;</span>
    <span class="kn">proxy_redirect</span>        <span class="no">off</span><span class="p">;</span>

    <span class="kn">proxy_set_header</span>      <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span>      <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span>      <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
    <span class="kn">proxy_pass_header</span>     <span class="s">Authorization</span><span class="p">;</span>

    <span class="kn">sendfile</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">tcp_nopush</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">tcp_nodelay</span> <span class="no">on</span><span class="p">;</span>

    <span class="c1"># Disable buffering and chunked encoding.</span>
    <span class="c1"># In the stream case we want to receive the whole payload at once, we don&#39;t</span>
    <span class="c1"># want multiple chunks.</span>
    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
    <span class="kn">chunked_transfer_encoding</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_cache</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1"># For backward compatibility reasons, rewrite requests from &quot;/api/stream&quot;</span>
  <span class="c1"># to &quot;/stream/v1/stream&quot; and &quot;/api/v1/stream&quot; to &quot;/stream/v1/stream&quot;</span>
  <span class="kn">location</span> <span class="s">/api/stream/</span> <span class="p">{</span>
    <span class="kn">rewrite</span> <span class="s">^/api/stream/?(.*)</span>$ <span class="s">/v1/stream/</span><span class="nv">$1</span> <span class="s">break</span><span class="p">;</span>
    <span class="kn">proxy_pass</span>  <span class="s">http://127.0.0.1:9102</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>

    <span class="kn">sendfile</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">tcp_nopush</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">tcp_nodelay</span> <span class="no">on</span><span class="p">;</span>

    <span class="c1"># Disable buffering and chunked encoding.</span>
    <span class="c1"># In the stream case we want to receive the whole payload at once, we don&#39;t</span>
    <span class="c1"># want multiple chunks.</span>
    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
    <span class="kn">chunked_transfer_encoding</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_cache</span> <span class="no">off</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kn">location</span> <span class="s">/api/v1/stream/</span> <span class="p">{</span>
    <span class="kn">rewrite</span> <span class="s">^/api/v1/stream/?(.*)</span>$ <span class="s">/v1/stream/</span><span class="nv">$1</span> <span class="s">break</span><span class="p">;</span>
    <span class="kn">proxy_pass</span>  <span class="s">http://127.0.0.1:9102</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>

    <span class="kn">sendfile</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">tcp_nopush</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">tcp_nodelay</span> <span class="no">on</span><span class="p">;</span>

    <span class="c1"># Disable buffering and chunked encoding.</span>
    <span class="c1"># In the stream case we want to receive the whole payload at once, we don&#39;t</span>
    <span class="c1"># want multiple chunks.</span>
    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
    <span class="kn">chunked_transfer_encoding</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_cache</span> <span class="no">off</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kn">location</span> <span class="s">/auth/</span> <span class="p">{</span>
    <span class="kn">rewrite</span> <span class="s">^/auth/(.*)</span>  <span class="s">/</span><span class="nv">$1</span> <span class="s">break</span><span class="p">;</span>

    <span class="kn">proxy_pass</span>            <span class="s">http://127.0.0.1:9100/</span><span class="p">;</span>
    <span class="kn">proxy_read_timeout</span>    <span class="mi">90</span><span class="p">;</span>
    <span class="kn">proxy_connect_timeout</span> <span class="mi">90</span><span class="p">;</span>
    <span class="kn">proxy_redirect</span>        <span class="no">off</span><span class="p">;</span>

    <span class="kn">proxy_set_header</span>      <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span>      <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span>      <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
    <span class="kn">proxy_pass_header</span>     <span class="s">Authorization</span><span class="p">;</span>

    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
    <span class="kn">chunked_transfer_encoding</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_cache</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kn">location</span> <span class="s">/mistral/</span> <span class="p">{</span>
    <span class="kn">rewrite</span> <span class="s">^/mistral/(.*)</span>  <span class="s">/</span><span class="nv">$1</span> <span class="s">break</span><span class="p">;</span>

    <span class="kn">proxy_pass</span>            <span class="s">http://127.0.0.1:8989/</span><span class="p">;</span>
    <span class="kn">proxy_read_timeout</span>    <span class="mi">90</span><span class="p">;</span>
    <span class="kn">proxy_connect_timeout</span> <span class="mi">90</span><span class="p">;</span>
    <span class="kn">proxy_redirect</span>        <span class="no">off</span><span class="p">;</span>

    <span class="kn">proxy_set_header</span>      <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span>      <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span>      <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
    <span class="kn">proxy_pass_header</span>     <span class="s">Authorization</span><span class="p">;</span>

    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
    <span class="kn">chunked_transfer_encoding</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_cache</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="13">
<li><p class="first">To use Timer triggers with Mistral, enable them on only one server. Make this change in
<code class="docutils literal notranslate"><span class="pre">/etc/st2/st2.conf</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">[</span><span class="nv">timer</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">enable = False</span>
</pre></div>
</div>
</li>
<li><p class="first">See <a class="reference internal" href="sensor_partitioning.html"><span class="doc">Partitioning Sensors</span></a> to decide how to partition sensors to suit your
requirements.</p>
</li>
<li><p class="first">All content should be synced by choosing a suitable strategy as outlined above. This is crucial
to obtain predictable outcomes.</p>
</li>
</ol>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="REST API Reference">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="client_libraries.html" class="btn btn-neutral" title="Client Libraries and Language Bindings"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014 - 2018, StackStorm.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  
  <div id="versions"></div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.8dev',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  

  <script type="text/javascript" src="/_static/js/versions.js"></script> 

</body>
</html>